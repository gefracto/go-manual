#+BEGIN_CENTER 
Если ты не видишь эту надпись, значит, твой deploy не удался
#+END_CENTER
[[file:петросян.jpg]]


Привет, %username%. 
Сегодня мы -- следуя этому мануалу -- задеплоим на хероку контейнер с этим мануалом. Такая вот рекурсия.

Отдохни, сделай кофе. 

Приготовься. 

Глубокий вдох. 

Готов?

* Инструменты
** Linux
+ Эмулятор терминала
** Windows
+ Git bash

#+BEGIN_CENTER
ПОЕХАЛИ!
#+END_CENTER


* Создаем новый проект

** На гитхабе
*** На github.com создаем новый репозиторий. Обзываем его именем вашего проекта.
[[file:newrepo.png]]
[[file:namerepo.png]]

*** Жмем Create

[[file:createrepo.png]]

*** Попадаем на страницу QuickSetup, можно её пока оставить - там инструкции для инициализации локального проекта.
[[file:inithelp.png]]

** Локально
*** Создаем директорию $GOPATH/src/github.com/yourgitname/yourproject и переходим в неё.
В моем случае это:
#+BEGIN_SRC sh
mkdir ~/go/src/github.com/gefracto/go-manual
cd ~/go/src/github.com/gefracto/go-manual
#+END_SRC

*** Со страницы QuickSetup git'a копируем команды, но не забываем добавить "git add .":
#+BEGIN_SRC sh
git init
git add .
git commit -m "first commit"
git remote add origin git@github.com:gefracto/go-manual.git
git push -u origin master
#+END_SRC

[[file:gitinit.png]] 

[[file:addcommit.png]] 

[[file:gitpusherror.png]] 


*** Ошибка команды git push
Возможно, ты увидишь такое же сообщение. 

#+BEGIN_SRC sh
fatal: cannot run ssh: Нет такого файла или каталога
fatal: unable to fork
#+END_SRC

Оно говорит о том, что нам нужно сгенерить ssh-key. 

Даже если тебе удалось запушить, все равно выполни этот шаг - ssh-key нам ещё пригодится.

*** Генерируем ssh
Выполняем в терминале:
#+BEGIN_SRC sh
ssh-keygen -t rsa -b 4096 -C "gefracto@circleci.com"
#+END_SRC

[[file:ssh-keygen.png]]

Заметь, что команда заканчивается комментарием "-C "gefracto@circleci.com"". До символа @ - это твой git-логин. В дальнейшем этот комментарий понадобится нам для деплоинга на хероку.

*** Привязываем ssh к github

**** Выполняем в консоли:
#+BEGIN_SRC sh
cat ~/.ssh/id_rsa.pub
#+END_SRC

[[file:id_rsapub.png]] 

Делаем ctrl+C этого мусора и идем на github.com.

**** Переходим в настройки нашего репозитория, находим пункт Deploy keys

[[file:gitsettings.png]]

[[file:deploykeys.png]]

**** Тыцаем "Add deploy key"
**** В поле title вводим имя любимого кота или название проекта. Без разницы.
**** В поле key вставляем скопированный ssh-мусор
**** Не забываем отметить галочкой "Allow write access"

[[file:adddeploykey.png]]

[[file:resaddgitkey.png]]

*** Повторяем git push, если В ПЕРВЫЙ РАЗ НЕ ПОЛУЧИЛОСЬ

[[file:continue.jpg]]

#+BEGIN_SRC sh
git push -u origin master
#+END_SRC

[[file:gitpushsuccess.png]]

#+BEGIN_CENTER
УСПЕХ!
Репозиторий создан. Можем теперь написать что-то на Go, а именно: простую программу, которая отдает static этого мануала.
#+END_CENTER

* Наполняем проект
** Static этого мануала
Ты можешь написать свой static, но я рекомендую использовать заготовленный мною.

**** Скачай этот [[https://drive.google.com/open?id=0BxQORje5K7bCd3Z0Y1RmelVzZGc][zip-файл]] , предварительно отключив антивирус (шутка), и распакуй в корень своего пустого проекта.

**** Создай в корне проекта файл main.go и скопипасть в него следующий текст:

#+BEGIN_SRC go
package main

import (
	"net/http"
	"os"
)

func main() {
	fileserver := http.FileServer(http.Dir("static"))
	http.Handle("/", fileserver)
	http.ListenAndServe(":"+os.Getenv("PORT"), nil)
}
#+END_SRC

После этих манипуляций корневая директория проекта выглядит так:
[[file:rootdir0.png]]

Делаем пуш:

#+BEGIN_SRC sh
git commit -am "my project"
git push -u origin master
#+END_SRC

#+BEGIN_CENTER
Теперь приступаем к самому захватывающему -- настройке CircleCi и Heroku
#+END_CENTER

* HEROKU.com
**** Логинимся на heroku.
**** Логинимся с помощью git-аккаунта
**** Идем в раздел projects
**** Идем в список своих проектов [[https://dashboard.heroku.com/apps]]
**** Добавляем новое приложение (Create new app)
[[file:addnewapp.png]]

**** Пишем имя своего проекта, либо любое другое, и жмакаем "Create App"
[[file:nameyourapp.png]]

**** Идем в настройки аккаунта (Account Settings)
[[file:accsettings.png]]

**** Добавляем новый ssh-key, который нужен для взаимодействия с CircleCI.
[[file:sshkeys.png]]

[[file:newsshkey.png]]

Напомню, что мы берем ssh, который создали ранее для привязки к git аккаунту.
Получить его можно командой:
#+BEGIN_SRC sh
cat ~/.ssh/id_rsa.pub
#+END_SRC

**** Save Changes
[[file:sshadded.png]]


#+BEGIN_CENTER
Забудем про HEROKU. 

Он нам больше не нужен. 

Почти.
#+END_CENTER

* CIRCLECI.com
**** Логинимся с помощью git-аккаунта
**** В меню выбираем Projects, кликаем свой git-аккаунт
[[file:projects.png]]

**** Жмем кнопку Add project
**** Снова выбираем свой git, находим свой проект и тыкаем Setup project
[[file:findproject.png]]

**** Выставляем параметры:
+ OS: Linux
+ Platform: 2.0
+ Language: Go

**** Начинаем билдить проект!
[[file:startbuilding.png]]
